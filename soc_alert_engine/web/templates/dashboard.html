<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOC Alert Enrichment Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #1a1a1a;
            color: #fff;
        }
        .navbar {
            background-color: #0d1117;
            border-bottom: 2px solid #238636;
        }
        .card {
            background-color: #0d1117;
            border: 1px solid #238636;
            margin-bottom: 20px;
        }
        .stat-card {
            text-align: center;
            padding: 20px;
        }
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #58a6ff;
        }
        .priority-high {
            color: #f85149;
            font-weight: bold;
        }
        .priority-medium {
            color: #d29922;
            font-weight: bold;
        }
        .priority-low {
            color: #3fb950;
            font-weight: bold;
        }
        table { color: #c9d1d9; }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">🔒 SOC Alert Enrichment Engine</span>
        </div>
    </nav>

    <div class="container-fluid mt-4">
        <div class="row mb-4" id="stats-container">
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="stat-number" id="stat-total">0</div>
                    <div>Total Alerts</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="stat-number priority-high" id="stat-high">0</div>
                    <div>High Priority</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="stat-number priority-medium" id="stat-medium">0</div>
                    <div>Medium Priority</div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="stat-number priority-low" id="stat-low">0</div>
                    <div>Low Priority</div>
                </div>
            </div>
        </div>

        <div class="mb-4">
            <button class="btn btn-outline-primary" onclick="filterAlerts(null)">All Alerts</button>
            <button class="btn btn-outline-danger" onclick="filterAlerts('High')">High</button>
            <button class="btn btn-outline-warning" onclick="filterAlerts('Medium')">Medium</button>
            <button class="btn btn-outline-success" onclick="filterAlerts('Low')">Low</button>
        </div>

        <div class="card">
            <div class="card-header">
                <h5>Enriched Security Alerts</h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Source IP</th>
                                <th>Destination IP</th>
                                <th>Alert Type</th>
                                <th>Risk Score</th>
                                <th>Priority</th>
                                <th>Message</th>
                            </tr>
                        </thead>
                        <tbody id="alerts-body"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        function loadStats() {
            fetch('/api/stats')
                .then(r => r.json())
                .then(data => {
                    document.getElementById('stat-total').textContent = data.total_alerts;
                    document.getElementById('stat-high').textContent = data.high_priority;
                    document.getElementById('stat-medium').textContent = data.medium_priority;
                    document.getElementById('stat-low').textContent = data.low_priority;
                });
        }

        function loadAlerts(priority = null) {
            const url = priority ? `/api/alerts?priority=${priority}` : '/api/alerts';
            fetch(url)
                .then(r => r.json())
                .then(alerts => {
                    const tbody = document.getElementById('alerts-body');
                    tbody.innerHTML = '';
                    alerts.forEach(alert => {
                        const pClass = `priority-${alert.priority.toLowerCase()}`;
                        const row = `<tr><td>${alert.timestamp}</td><td>${alert.source_ip}</td><td>${alert.destination_ip}</td><td>${alert.alert_type}</td><td>${alert.risk_score}</td><td><span class="${pClass}">${alert.priority}</span></td><td>${alert.message}</td></tr>`;
                        tbody.innerHTML += row;
                    });
                });
        }

        function filterAlerts(priority) {
            loadAlerts(priority);
        }

        loadStats();
        loadAlerts();
        setInterval(() => { loadStats(); loadAlerts(); }, 10000);
    </script>
</body>
</html>
